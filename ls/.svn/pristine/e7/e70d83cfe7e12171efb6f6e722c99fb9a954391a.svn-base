<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Login extends CI_Controller {


	public function index()
	{
		$this->load->view('admin/login');
	}

	public function loginme(){
		$conf = $this->cacheqq->pre_fetch();

		if(isset($_POST['user']) && isset($_POST['pass'])){
			$user=$_POST['user'];
			$pass=$_POST['pass'];
			if($user==$conf['admin_user'] && $pass==$conf['admin_pwd']) {
				$session=md5($user.$pass.$password_hash);
				$token=authcode("{$user}\t{$session}", 'ENCODE', SYS_KEY);
				setcookie("admin_token", $token, time() + 604800);
				@header('Content-Type: text/html; charset=UTF-8');
				exit("<script language='javascript'>alert('登陆管理中心成功！');window.location.href='/admin/home';</script>");
			}elseif ($pass != $conf['admin_pwd']) {
				@header('Content-Type: text/html; charset=UTF-8');
				exit("<script language='javascript'>alert('用户名或密码不正确！');history.go(-1);</script>");
			}
		}
	}


	// public function logout(){
		
	// }
}
